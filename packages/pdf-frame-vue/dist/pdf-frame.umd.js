(function(h,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("i2djs"),require("vue")):typeof define=="function"&&define.amd?define(["exports","i2djs","vue"],s):(h=typeof globalThis<"u"?globalThis:h||self,s(h["pdf-frame"]={},h.i2djs,h.vue))})(this,function(h,s,l){"use strict";const O=["i-g","i-group","i-circle","i-line","i-path","i-ellipse","i-polygon","i-polyline","i-rect","i-text","i-image","i-page","i-linearGradient","i-radialGradient","i-page-template","i-animate","i-animatePath"];function q(a){const u={},m={},r={},{render:y}=l.createRenderer({patchProp(e,t,n,i,d,p,c,C,S){x(t)(e,i)},insert:(e,t,n)=>{!e||!t||!t.child||e instanceof s.CanvasGradient||(e.nodeName==="animate"?(e.parent=t,l.nextTick().then(()=>{t.animateTo(e,e.from)})):e.nodeName==="animatePath"?(e.parent=t,l.nextTick().then(()=>{t.animatePathTo(e,e.from)})):t.child([e]))},remove:e=>{e!=null&&e.remove()},createElement:(e,t,n,i)=>{var S,T,A;const d=e.split("-").slice(1).join("-");let p=O.indexOf(e),c=null,C=a.ctx.type_;switch(p===-1&&console.warn(`Unknown PDF-Frame tag: ${e}`),d){case"page-template":if(C!=="pdf")return console.warn("page-template element is invalid in canvas context"),null;c=a.createTemplate(),m[i.id]=c;break;case"page":if(C!=="pdf")return console.warn("Page element is invalid in canvas context"),null;c=a.addPage();break;case"linearGradient":c=s.createLinearGradient(),r[i.id]=c;break;case"radialGradient":c=s.createRadialGradient(),r[i.id]=c;break;case"animate":c=f(i),i.from&&(c.from={attr:{...i.from,style:null},style:((S=i.from)==null?void 0:S.style)??{}});break;case"animatePath":c=o(i),i.from&&(c.from={attr:{d:((T=i==null?void 0:i.from)==null?void 0:T.d)??"",style:null},style:((A=i.from)==null?void 0:A.style)??{}});break;default:c=g(d,i);break}return c},createText:e=>{},createComment:e=>{},setText:(e,t)=>{},setElementText:(e,t)=>{},parentNode:e=>e&&e.dom.parent?e.dom.parent:null,nextSibling:e=>(t,n)=>{},querySelector:e=>a.fetchEl(e)||null}),x=e=>(t,n)=>{if(typeof n=="function"&&(n=n(t)),e!=="style")if(e==="src"&&!u[n])u[n]=a.createAsyncTexture({attr:{src:n}}),u[n].then(i=>{u[n]=i.exportAsDataUrl(),t.setAttr(e,u[n])});else if(e==="src"&&u[n])t.setAttr(e,u[n]);else if(e==="text"&&n)t.text(n);else if(e==="p-template"&&t instanceof s.CanvasNodeExe)t.addTemplate(m[n]);else if(e==="event")for(let i in n)t.on&&t.on(i,n[i]);else e==="block"?t.block=!0:e==="data"?t.data(n):e==="transform"?t.setAttr(e,w(n)):e==="bbox"?t.bbox=n:t.setAttr(e,n);else for(let i in n){let d=n[i];if(typeof d=="function"&&(d=d(t)),(i==="fillStyle"||i==="strokeStyle")&&typeof d=="string"&&d.startsWith("grad")){const p=d.match(/\(([^)]+)\)/)[1];d=b(p)}t.setStyle(i,d)}};function g(e,t){return new s.CanvasNodeExe(a.ctx,{el:e==="group"?"g":e,attr:{},style:{},bbox:t&&t.bbox!==void 0?t.bbox:!0},Math.round(Math.random()*1e7),0)}function w(e){if(typeof e=="object"&&!Array.isArray(e)&&e!==null)return e;const t={};for(const n in e=e.match(/(\w+\((\-?\d+\.?\d*e?\-?\d*,?)+\))+/g)){const i=e[n].match(/[\w\.\-]+/g);t[i.shift()]=i.map(d=>parseFloat(d))}return t}function b(e){return r[e]}function f(e){var t;return{nodeName:"animate",attr:{...(e==null?void 0:e.to)??{},style:null},style:((t=e==null?void 0:e.to)==null?void 0:t.style)??{},duration:e.duration||0,ease:e.ease||"default",loop:e.loop||0,end:e.end||null,delay:e.delay||0,direction:e.direction||"default",setAttr:function(n,i){},setStyle:function(n,i){},remove:function(){this.parent.interrupt()}}}function o(e){var t,n;return{nodeName:"animatePath",attr:{d:((t=e==null?void 0:e.to)==null?void 0:t.d)??"",style:null},style:((n=e==null?void 0:e.to)==null?void 0:n.style)??{},duration:e.duration||0,ease:e.ease||"default",loop:e.loop||0,end:e.end||null,delay:e.delay||0,direction:e.direction||"default",setAttr:function(i,d){},setStyle:function(i,d){},remove:function(){this.parent.interrupt()}}}return y}const I=l.defineComponent({props:{type:{type:String,required:!0,default:"pdf"},id:{type:String,required:!0,default:"pdf-frame-id"},height:{type:Number,required:!1,default:0},width:{type:Number,required:!1,default:0},layerSetting:{type:Object,required:!1,default:()=>{}},onUpdate:{type:Function,required:!1,default:()=>{}},config:{type:Object,required:!1,default:()=>{}},info:{type:Object,required:!1,default:()=>{}},encryption:{type:Object,required:!1,default:()=>{}}},emits:["on-resize","on-ready","on-update"],setup(a,u){let m,r=null;const y=l.getCurrentInstance();l.onMounted(()=>{l.nextTick().then(()=>{const f=u.slots.default;r||(a.type==="pdf"||a.type==="pdf-blob"?r=g(a):a.type==="canvas"?r=w(a):console.warn(`Unknown render context: ${a.type}`)),r&&r.onResize&&r.onResize(()=>{u.emit("on-resize",{height:r.height,width:r.width})});const o=q(r),e=l.h(x,f);o(e,r),u.emit("on-ready",r)})}),l.onUnmounted(()=>{r&&(r.destroy(),r=null)}),l.watch(()=>a.encryption,f=>{r.setConfig&&r.setConfig({encryption:f})},{deep:!0}),l.watch(()=>a.info,f=>{r.setConfig&&r.setConfig({info:f})},{deep:!0}),l.watch(()=>a.config,f=>{r.setConfig&&r.setConfig({...f})},{deep:!0});const x=l.defineComponent({setup(f,o){const e=l.getCurrentInstance();e.parent=y,e.appContext=y.appContext,e.root=y.root,e.provides=y.provides;const t=o.slots.default;return()=>l.h(l.Fragment,t())}});function g(f){let o=document.getElementById(m.props.id);return s.pdfLayer(o,{height:f.height,width:f.width,...f.config||{},info:f.info||{},encryption:f.encryption||{}},{autoUpdate:!0,onUpdate:t=>{o.tagName==="IFRAME"&&o.setAttribute("src",t),f.onUpdate&&b(t)}})}function w(f){let o=document.getElementById(m.props.id);return s.canvasLayer(o,f.config,{...f.layerSetting,onUpdate:()=>{b()}})}switch(a.type){case"pdf":m=l.h("iframe",{id:a.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break;case"pdf-blob":m=l.h("div",{id:a.id,class:"renderOutput",style:{height:"100%",width:"100%"}});break;case"canvas":m=l.h("div",{id:a.id,class:"renderOutput",style:{height:a.height?a.height+"px":"100%",width:a.width?a.width+"px":"100%"}});break;case"default":m=l.h("iframe",{id:a.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break}function b(f){u.emit("on-update",f)}return()=>m}});h.default=I,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
