"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("i2djs"),f=require("vue"),N=["i-g","i-group","i-circle","i-line","i-path","i-ellipse","i-polygon","i-polyline","i-rect","i-text","i-image","i-page","i-linearGradient","i-radialGradient","i-page-template","i-animate","i-animatePath"];function q(a){const c={},u={},r={},{render:o}=f.createRenderer({patchProp(e,n,i,t,l,y,d,p,w){g(n)(e,t)},insert:(e,n,i)=>{!e||!n||!n.child||e instanceof s.CanvasGradient||(e.nodeName==="animate"?(e.parent=n,f.nextTick().then(()=>{n.animateTo(e,e.from)})):e.nodeName==="animatePath"?(e.parent=n,f.nextTick().then(()=>{n.animatePathTo(e)})):n.child([e]))},remove:e=>{e!=null&&e.remove()},createElement:(e,n,i,t)=>{var p,w,S,T;const l=e.split("-").slice(1).join("-");let y=N.indexOf(e),d=null;switch(y===-1&&console.warn(`Unknown PDF-Frame tag: ${e}`),l){case"page-template":d=a.createTemplate(),u[t.id]=d;break;case"page":d=a.addPage();break;case"linearGradient":d=s.createLinearGradient(),r[t.id]=d;break;case"radialGradient":d=s.createRadialGradient(),r[t.id]=d;break;case"animate":d={nodeName:"animate",attr:{...(t==null?void 0:t.to)??{},style:null},style:((p=t==null?void 0:t.to)==null?void 0:p.style)??{},duration:t.duration||0,ease:t.ease||"default",loop:t.loop||0,end:t.end||null,delay:t.delay||0,direction:t.direction||"default",setAttr:function(x,C){},setStyle:function(x,C){},remove:function(){this.parent.interrupt()}},t.from&&(d.from={attr:{...t.from,style:null},style:((w=t.from)==null?void 0:w.style)??{}});break;case"animatePath":d={nodeName:"animatePath",from:{attr:{...t.from,style:null},style:((S=t==null?void 0:t.from)==null?void 0:S.style)??{}},attr:{...(t==null?void 0:t.to)??{},style:null},style:((T=t==null?void 0:t.to)==null?void 0:T.style)??{},duration:t.duration||0,ease:t.ease||"default",loop:t.loop||0,end:t.end||null,delay:t.delay||0,direction:t.direction||"default",setAttr:function(x,C){},setStyle:function(x,C){},remove:function(){this.parent.interrupt()}};break;default:d=m(l);break}return d},createText:e=>{},createComment:e=>{},setText:(e,n)=>{},setElementText:(e,n)=>{},parentNode:e=>e&&e.dom.parent?e.dom.parent:null,nextSibling:e=>(n,i)=>{},querySelector:e=>a.fetchEl(e)||null}),g=e=>(n,i)=>{if(typeof i=="function"&&(i=i(n)),e!=="style")if(e==="src"&&!c[i])c[i]=a.createAsyncTexture({attr:{src:i}}),c[i].then(t=>{c[i]=t.exportAsDataUrl(),n.setAttr(e,c[i])});else if(e==="src"&&c[i])n.setAttr(e,c[i]);else if(e==="text"&&i)n.text(i);else if(e==="p-template"&&n instanceof s.CanvasNodeExe)n.addTemplate(u[i]);else if(e==="event")for(let t in i)n.on&&n.on(t,i[t]);else e==="block"?n.block=!0:e==="data"?n.data(i):e==="transform"?n.setAttr(e,b(i)):n.setAttr(e,i);else for(let t in i){let l=i[t];if(typeof l=="function"&&(l=l(n)),(t==="fillStyle"||t==="strokeStyle")&&typeof l=="string"&&l.startsWith("grad")){const y=l.match(/\(([^)]+)\)/)[1];l=h(y)}n.setStyle(t,l)}};function m(e,n){return new s.CanvasNodeExe(a.ctx,{el:e==="group"?"g":e,attr:{},style:{}},Math.round(Math.random()*1e7),0)}function b(e){if(typeof e=="object"&&!Array.isArray(e)&&e!==null)return e;const n={};for(const i in e=e.match(/(\w+\((\-?\d+\.?\d*e?\-?\d*,?)+\))+/g)){const t=e[i].match(/[\w\.\-]+/g);n[t.shift()]=t.map(l=>parseFloat(l))}return n}function h(e){return r[e]}return o}const A=f.defineComponent({props:{type:{type:String,required:!0,default:"pdf"},id:{type:String,required:!0,default:"pdf-frame-id"},height:{type:Number,required:!1,default:0},width:{type:Number,required:!1,default:0},layerSetting:{type:Object,required:!1,default:()=>{}},onUpdate:{type:Function,required:!1,default:()=>{}},config:{type:Object,required:!1,default:()=>{}},info:{type:Object,required:!1,default:()=>{}},encryption:{type:Object,required:!1,default:()=>{}}},emits:["on-resize","on-ready","on-update"],setup(a,c){let u,r=null;const o=f.getCurrentInstance();f.onMounted(()=>{f.nextTick().then(()=>{const e=c.slots.default;r||(a.type==="pdf"||a.type==="pdf-blob"?r=m(a):a.type==="canvas"?r=b(a):console.warn(`Unknown render context: ${a.type}`)),r&&r.onResize&&r.onResize(()=>{c.emit("on-resize",{height:r.height,width:r.width})});const n=q(r),i=f.h(g,e);n(i,r),c.emit("on-ready",r)})}),f.onUnmounted(()=>{r&&(r.destroy(),r=null)}),f.watch(()=>a.encryption,e=>{r.setConfig&&r.setConfig({encryption:e})},{deep:!0}),f.watch(()=>a.info,e=>{r.setConfig&&r.setConfig({info:e})},{deep:!0}),f.watch(()=>a.config,e=>{r.setConfig&&r.setConfig({...e})},{deep:!0});const g=f.defineComponent({setup(e,n){const i=f.getCurrentInstance();i.parent=o,i.appContext=o.appContext,i.root=o.root,i.provides=o.provides;const t=n.slots.default;return()=>f.h(f.Fragment,t())}});function m(e){let n=document.getElementById(u.props.id);return s.pdfLayer(n,{height:e.height,width:e.width,...e.config||{},info:e.info||{},encryption:e.encryption||{}},{autoUpdate:!0,onUpdate:t=>{n.tagName==="IFRAME"&&n.setAttribute("src",t),e.onUpdate&&h(t)}})}function b(e){let n=document.getElementById(u.props.id);return s.canvasLayer(n,e.config,{...e.layerSetting,onUpdate:()=>{h()}})}switch(a.type){case"pdf":u=f.h("iframe",{id:a.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break;case"pdf-blob":u=f.h("div",{id:a.id,class:"renderOutput",style:{height:"100%",width:"100%"}});break;case"canvas":u=f.h("div",{id:a.id,class:"renderOutput",style:{height:a.height?a.height+"px":"100%",width:a.width?a.width+"px":"100%"}});break;case"default":u=f.h("iframe",{id:a.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break}function h(e){c.emit("on-update",e)}return()=>u}});exports.default=A;
