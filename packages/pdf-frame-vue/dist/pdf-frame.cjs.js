"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const m=require("i2djs"),l=require("vue"),A=["i-g","i-group","i-circle","i-line","i-path","i-ellipse","i-polygon","i-polyline","i-rect","i-text","i-image","i-page","i-linearGradient","i-radialGradient","i-page-template","i-animate","i-animatePath"];function O(a){const u={},o={},r={},{render:h}=l.createRenderer({patchProp(e,t,i,n,c,b,d,w,C){x(t)(e,n)},insert:(e,t,i)=>{!e||!t||!t.child||e instanceof m.CanvasGradient||(e.nodeName==="animate"?(e.parent=t,l.nextTick().then(()=>{t.animateTo(e,e.from)})):e.nodeName==="animatePath"?(e.parent=t,l.nextTick().then(()=>{t.animatePathTo(e,e.from)})):t.child([e]))},remove:e=>{e!=null&&e.remove()},createElement:(e,t,i,n)=>{var C,S,T;const c=e.split("-").slice(1).join("-");let b=A.indexOf(e),d=null,w=a.ctx.type_;switch(b===-1&&console.warn(`Unknown PDF-Frame tag: ${e}`),c){case"page-template":if(w!=="pdf")return console.warn("page-template element is invalid in canvas context"),null;d=a.createTemplate(),o[n.id]=d;break;case"page":if(w!=="pdf")return console.warn("Page element is invalid in canvas context"),null;d=a.addPage();break;case"linearGradient":d=m.createLinearGradient(),r[n.id]=d;break;case"radialGradient":d=m.createRadialGradient(),r[n.id]=d;break;case"animate":d=f(n),n.from&&(d.from={attr:{...n.from,style:null},style:((C=n.from)==null?void 0:C.style)??{}});break;case"animatePath":d=s(n),n.from&&(d.from={attr:{d:((S=n==null?void 0:n.from)==null?void 0:S.d)??"",style:null},style:((T=n.from)==null?void 0:T.style)??{}});break;default:d=y(c,n);break}return d},createText:e=>{},createComment:e=>{},setText:(e,t)=>{},setElementText:(e,t)=>{},parentNode:e=>e&&e.dom.parent?e.dom.parent:null,nextSibling:e=>(t,i)=>{},querySelector:e=>a.fetchEl(e)||null}),x=e=>(t,i)=>{if(typeof i=="function"&&(i=i(t)),e!=="style")if(e==="src"&&!u[i])u[i]=a.createAsyncTexture({attr:{src:i}}),u[i].then(n=>{u[i]=n.exportAsDataUrl(),t.setAttr(e,u[i])});else if(e==="src"&&u[i])t.setAttr(e,u[i]);else if(e==="text"&&i)t.text(i);else if(e==="p-template"&&t instanceof m.CanvasNodeExe)t.addTemplate(o[i]);else if(e==="event")for(let n in i)t.on&&t.on(n,i[n]);else e==="block"?t.block=!0:e==="data"?t.data(i):e==="transform"?t.setAttr(e,p(i)):e==="bbox"||t.setAttr(e,i);else for(let n in i){let c=i[n];if(typeof c=="function"&&(c=c(t)),(n==="fillStyle"||n==="strokeStyle")&&typeof c=="string"&&c.startsWith("grad")){const b=c.match(/\(([^)]+)\)/)[1];c=g(b)}t.setStyle(n,c)}};function y(e,t){return new m.CanvasNodeExe(a.ctx,{el:e==="group"?"g":e,attr:{},style:{},bbox:t.bbox!==void 0?t.bbox:!0},Math.round(Math.random()*1e7),0)}function p(e){if(typeof e=="object"&&!Array.isArray(e)&&e!==null)return e;const t={};for(const i in e=e.match(/(\w+\((\-?\d+\.?\d*e?\-?\d*,?)+\))+/g)){const n=e[i].match(/[\w\.\-]+/g);t[n.shift()]=n.map(c=>parseFloat(c))}return t}function g(e){return r[e]}function f(e){var t;return{nodeName:"animate",attr:{...(e==null?void 0:e.to)??{},style:null},style:((t=e==null?void 0:e.to)==null?void 0:t.style)??{},duration:e.duration||0,ease:e.ease||"default",loop:e.loop||0,end:e.end||null,delay:e.delay||0,direction:e.direction||"default",setAttr:function(i,n){},setStyle:function(i,n){},remove:function(){this.parent.interrupt()}}}function s(e){var t,i;return{nodeName:"animatePath",attr:{d:((t=e==null?void 0:e.to)==null?void 0:t.d)??"",style:null},style:((i=e==null?void 0:e.to)==null?void 0:i.style)??{},duration:e.duration||0,ease:e.ease||"default",loop:e.loop||0,end:e.end||null,delay:e.delay||0,direction:e.direction||"default",setAttr:function(n,c){},setStyle:function(n,c){},remove:function(){this.parent.interrupt()}}}return h}const q=l.defineComponent({props:{type:{type:String,required:!0,default:"pdf"},id:{type:String,required:!0,default:"pdf-frame-id"},height:{type:Number,required:!1,default:0},width:{type:Number,required:!1,default:0},layerSetting:{type:Object,required:!1,default:()=>{}},onUpdate:{type:Function,required:!1,default:()=>{}},config:{type:Object,required:!1,default:()=>{}},info:{type:Object,required:!1,default:()=>{}},encryption:{type:Object,required:!1,default:()=>{}}},emits:["on-resize","on-ready","on-update"],setup(a,u){let o,r=null;const h=l.getCurrentInstance();l.onMounted(()=>{l.nextTick().then(()=>{const f=u.slots.default;r||(a.type==="pdf"||a.type==="pdf-blob"?r=y(a):a.type==="canvas"?r=p(a):console.warn(`Unknown render context: ${a.type}`)),r&&r.onResize&&r.onResize(()=>{u.emit("on-resize",{height:r.height,width:r.width})});const s=O(r),e=l.h(x,f);s(e,r),u.emit("on-ready",r)})}),l.onUnmounted(()=>{r&&(r.destroy(),r=null)}),l.watch(()=>a.encryption,f=>{r.setConfig&&r.setConfig({encryption:f})},{deep:!0}),l.watch(()=>a.info,f=>{r.setConfig&&r.setConfig({info:f})},{deep:!0}),l.watch(()=>a.config,f=>{r.setConfig&&r.setConfig({...f})},{deep:!0});const x=l.defineComponent({setup(f,s){const e=l.getCurrentInstance();e.parent=h,e.appContext=h.appContext,e.root=h.root,e.provides=h.provides;const t=s.slots.default;return()=>l.h(l.Fragment,t())}});function y(f){let s=document.getElementById(o.props.id);return m.pdfLayer(s,{height:f.height,width:f.width,...f.config||{},info:f.info||{},encryption:f.encryption||{}},{autoUpdate:!0,onUpdate:t=>{s.tagName==="IFRAME"&&s.setAttribute("src",t),f.onUpdate&&g(t)}})}function p(f){let s=document.getElementById(o.props.id);return m.canvasLayer(s,f.config,{...f.layerSetting,onUpdate:()=>{g()}})}switch(a.type){case"pdf":o=l.h("iframe",{id:a.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break;case"pdf-blob":o=l.h("div",{id:a.id,class:"renderOutput",style:{height:"100%",width:"100%"}});break;case"canvas":o=l.h("div",{id:a.id,class:"renderOutput",style:{height:a.height?a.height+"px":"100%",width:a.width?a.width+"px":"100%"}});break;case"default":o=l.h("iframe",{id:a.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break}function g(f){u.emit("on-update",f)}return()=>o}});exports.default=q;
