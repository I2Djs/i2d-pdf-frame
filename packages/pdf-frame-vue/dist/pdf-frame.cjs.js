"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("i2djs"),d=require("vue"),b=["i-group","i-circle","i-line","i-path","i-ellipse","i-polygon","i-polyline","i-rect","i-text","i-image","i-page","i-linearGradient","i-radialGradient","i-page-template"];function w(i){const o={},c={},r={},{render:u}=d.createRenderer({patchProp(e,t,n,a,s,m,f,x,S){g(t)(e,a)},insert:(e,t,n)=>{!e||!t||!t.child||e instanceof l.CanvasGradient||t.child([e])},remove:e=>{e!=null&&e.remove()},createElement:(e,t,n,a)=>{const s=e.split("-").slice(1).join("-");let m=b.indexOf(e),f=null;switch(m===-1&&console.warn(`Unknown PDF-Frame tag: ${e}`),s){case"page-template":f=i.createTemplate(),c[a.id]=f;break;case"page":f=i.addPage();break;case"linearGradient":f=l.createLinearGradient(),r[a.id]=f;break;case"radialGradient":f=l.createRadialGradient(),r[a.id]=f;break;default:f=p(s);break}return f},createText:e=>{},createComment:e=>{},setText:(e,t)=>{},setElementText:(e,t)=>{},parentNode:e=>e&&e.dom.parent?e.dom.parent:null,nextSibling:e=>(t,n)=>{},querySelector:e=>i.fetchEl(e)||null}),g=e=>(t,n)=>{if(typeof n=="function"&&(n=n(t)),e!=="style")e==="src"&&!o[n]?(o[n]=i.createAsyncTexture({attr:{src:n}}),o[n].then(a=>{o[n]=a.exportAsDataUrl(),t.setAttr(e,o[n])})):e==="src"&&o[n]?t.setAttr(e,o[n]):e==="text"&&n?t.text(n):e==="p-template"&&t instanceof l.CanvasNodeExe?t.addTemplate(c[n]):t.setAttr(e,e==="transform"?y(n):n);else for(let a in n){let s=n[a];if((a==="fillStyle"||a==="strokeStyle")&&typeof s=="string"&&s.startsWith("grad")){const m=s.match(/\(([^)]+)\)/)[1];s=h(m)}t.setStyle(a,s)}};function p(e,t){return new l.CanvasNodeExe(i.ctx,{el:e,attr:{},style:{}},Math.round(Math.random()*1e7),0)}function y(e){if(typeof e=="object"&&!Array.isArray(e)&&e!==null)return e;const t={};for(const n in e=e.match(/(\w+\((\-?\d+\.?\d*e?\-?\d*,?)+\))+/g)){const a=e[n].match(/[\w\.\-]+/g);t[a.shift()]=a.map(s=>parseFloat(s))}return t}function h(e){return r[e]}return u}const C=d.defineComponent({props:{type:{type:String,required:!0,default:"pdf"},id:{type:String,required:!0,default:"pdf-frame-id"},height:{type:Number,required:!1,default:0},width:{type:Number,required:!1,default:0},layerSetting:{type:Object,required:!1,default:()=>{}},onUpdate:{type:Function,required:!1,default:()=>{}},config:{type:Object,required:!1,default:()=>{}},info:{type:Object,required:!1,default:()=>{}},encryption:{type:Object,required:!1,default:()=>{}}},emits:["on-resize","on-ready","on-update"],setup(i,o){let c,r=null;const u=d.getCurrentInstance();d.onMounted(()=>{d.nextTick().then(()=>{const e=o.slots.default;r||(i.type==="pdf"||i.type==="pdf-blob"?r=p(i):i.type==="canvas"?r=y(i):console.warn(`Unknown render context: ${i.type}`)),r&&r.onResize&&r.onResize(()=>{o.emit("on-resize",{height:r.height,width:r.width})});const t=w(r),n=d.h(g,e);t(n,r),o.emit("on-ready",r)})}),d.onUnmounted(()=>{r&&(r.destroy(),r=null)}),d.watch(()=>i.encryption,e=>{r.setConfig&&r.setConfig({encryption:e})},{deep:!0}),d.watch(()=>i.info,e=>{r.setConfig&&r.setConfig({info:e})},{deep:!0}),d.watch(()=>i.config,e=>{r.setConfig&&r.setConfig({...e})},{deep:!0});const g=d.defineComponent({setup(e,t){const n=d.getCurrentInstance();n.parent=u,n.appContext=u.appContext,n.root=u.root,n.provides=u.provides;const a=t.slots.default;return()=>d.h(d.Fragment,a())}});function p(e){let t=document.getElementById(c.props.id);return l.pdfLayer(t,{height:e.height,width:e.width,...e.config||{},info:e.info||{},encryption:e.encryption||{}},{autoUpdate:!0,onUpdate:a=>{t.tagName==="IFRAME"&&t.setAttribute("src",a),e.onUpdate&&h(a)}})}function y(e){let t=document.getElementById(c.props.id);return l.canvasLayer(t,e.config,{...e.layerSetting,onUpdate:()=>{h()}})}switch(i.type){case"pdf":c=d.h("iframe",{id:i.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break;case"pdf-blob":c=d.h("div",{id:i.id,class:"renderOutput",style:{height:"100%",width:"100%"}});break;case"canvas":c=d.h("div",{id:i.id,class:"renderOutput",style:{height:i.height?i.height+"px":"100%",width:i.width?i.width+"px":"100%"}});break;case"default":c=d.h("iframe",{id:i.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break}function h(e){o.emit("on-update",e)}return()=>c}});exports.default=C;
