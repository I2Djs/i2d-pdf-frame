"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const p=require("i2djs"),a=require("vue"),C=["i-group","i-circle","i-line","i-path","i-ellipse","i-polygon","i-polyline","i-rect","i-text","i-image","i-page-template"];function b(r){const c={},u={},h={},{render:y}=a.createRenderer({patchProp(e,t,n,i,d,g,o,w,T){x(t)(e,i)},insert:(e,t,n)=>{!e||!t||!t.child||e instanceof p.CanvasGradient||t.child([e])},remove:e=>{e!=null&&e.remove()},createElement:(e,t,n,i)=>{const d=e.split("-").slice(1).join("-");let g=C.indexOf(e),o=null;switch(g===-1&&console.warn(`Unknown I2Djs tag: ${e}`),d){case"page-template":o=r.createTemplate(),u[i.id]=o;break;case"page":o=r.addPage();break;case"linearGradient":o=p.createLinearGradient(),h[i.id]=o;break;case"radialGradient":o=p.createRadialGradient(),h[i.id]=o;break;default:o=l(d);break}return o},createText:e=>{},createComment:e=>{},setText:(e,t)=>{},setElementText:(e,t)=>{},parentNode:e=>e&&e.dom.parent?e.dom.parent:null,nextSibling:e=>(t,n)=>{},querySelector:e=>r.fetchEl(e)||null}),x=e=>(t,n)=>{if(typeof n=="function"&&(n=n(t)),e!=="style")e==="src"&&!c[n]?(c[n]=r.createAsyncTexture({attr:{src:n}}),c[n].then(i=>{c[n]=i.exportAsDataUrl(),t.setAttr(e,c[n])})):e==="src"&&c[n]?t.setAttr(e,c[n]):e==="text"&&n?t.text(n):e==="p-template"&&t instanceof p.CanvasNodeExe?t.addTemplate(u[n]):t.setAttr(e,e==="transform"?s(n):n);else for(let i in n){let d=n[i];if((i==="fillStyle"||i==="strokeStyle")&&typeof d=="string"&&d.startsWith("grad")){const g=d.match(/\(([^)]+)\)/)[1];d=m(g)}t.setStyle(i,d)}};function l(e,t){return new p.CanvasNodeExe(r.ctx,{el:e,attr:{},style:{}},Math.round(Math.random()*1e7),0)}function s(e){if(typeof e=="object"&&!Array.isArray(e)&&e!==null)return e;const t={};for(const n in e=e.match(/(\w+\((\-?\d+\.?\d*e?\-?\d*,?)+\))+/g)){const i=e[n].match(/[\w\.\-]+/g);t[i.shift()]=i.map(d=>parseFloat(d))}return t}function m(e){return h[e]}return y}let f=null;const S=a.defineComponent({props:{type:{type:String,required:!0},id:{type:String,required:!0},height:{type:Number,required:!0},width:{type:Number,required:!0},margin:{type:Number,required:!0},ctxConfig:{type:Object,required:!1,default:()=>{}},layerSetting:{type:Object,required:!1,default:()=>{}}},setup(r,c){const u=a.getCurrentInstance();a.onMounted(()=>{const s=c.slots.default;f&&f.flush(),f||(r.type==="pdf"?f=y(r):r.type==="canvas"?f=x(r):console.warn(`Unknown render context: ${r.type}`));const m=b(f);a.nextTick().then(()=>{const e=a.h(h,s);m(e,f)})});const h=a.defineComponent({setup(s,m){const e=a.getCurrentInstance();e.parent=u,e.appContext=u.appContext,e.root=u.root,e.provides=u.provides;const t=m.slots.default;return()=>a.h(a.Fragment,t())}});function y(s){return p.pdfLayer(l.el,{height:s.height,width:s.width,margin:s.margin},{onUpdate:e=>{l.el.setAttribute("src",e)}})}function x(s){return p.canvasLayer(l.el,s.ctxConfig,s.layerSetting)}let l;switch(r.type){case"pdf":l=a.h("iframe",{id:r.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break;case"canvas":l=a.h("div",{id:r.id,class:"renderOutput"});break;case"default":l=a.h("iframe",{id:r.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null});break}return()=>l}});exports.default=S;
