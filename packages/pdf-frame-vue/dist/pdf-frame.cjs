"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const m=require("i2djs"),c=require("vue"),q=["i-g","i-group","i-circle","i-line","i-path","i-ellipse","i-polygon","i-polyline","i-rect","i-text","i-image","i-page","i-linearGradient","i-radialGradient","i-page-template","i-animate","i-animatePath"];function j(r){const u={},s={},n={},{render:y}=c.createRenderer({patchProp(e,t,i,a,l,b,d,w,A){e&&f(t)(e,a)},insert:(e,t,i)=>{if(t=t||r,e&&t instanceof m.PDFCreator&&t.pages&&(["template","page"].includes(e.nodeName)||(t=t.pages.length?t.pages[0]:t.addPage())),!(!e||!(t!=null&&t.child))&&!(e instanceof m.canvasGradient))if(e.nodeName==="animate"||e.nodeName==="animatePath"){const a=e.nodeName==="animate"?"animateTo":"animatePathTo";e.parent=t,c.nextTick().then(()=>{t[a](e,e.from)})}else t.child([e])},remove:e=>{e!=null&&e.remove()},createElement:(e,t,i,a)=>{var A,N,T;const l=e.split("-").slice(1).join("-");let b=q.indexOf(e),d=null,w=r instanceof m.PDFCreator?"pdf":"canvas";if(b===-1&&console.warn(`Unknown PDF-Frame tag: ${e}`),(l==="animate"||l==="animatePath")&&w==="pdf")return null;switch(l){case"page-template":if(w!=="pdf")return console.warn("page-template element is invalid in canvas context"),null;d=r.createTemplate(),d.nodeName="template",s[a.id]=d;break;case"page":if(w!=="pdf")return console.warn("Page element is invalid in canvas context"),null;d=r.addPage(),d.nodeName="page";break;case"linearGradient":d=m.createLinearGradient(),n[a.id]=d,d.nodeName="linearGradient";break;case"radialGradient":d=m.createRadialGradient(),n[a.id]=d,d.nodeName="radialGradient";break;case"animate":d=x(a),a.from&&(d.from={attr:{...a.from,style:null},style:((A=a.from)==null?void 0:A.style)??{}});break;case"animatePath":d=O(a),a.from&&(d.from={attr:{d:((N=a==null?void 0:a.from)==null?void 0:N.d)??"",style:null},style:((T=a.from)==null?void 0:T.style)??{}});break;default:d=h(l,a);break}return d},createText:e=>{},createComment:e=>{},setText:(e,t)=>{},setElementText:(e,t)=>{},parentNode:e=>e&&e.dom.parent?e.dom.parent:null,nextSibling:e=>(t,i)=>{},querySelector:e=>r.fetchEl(e)||null}),S=e=>e.includes("-")?e.replace(/-([a-z])/g,(t,i)=>i.toUpperCase()):e,C=(e,t,i)=>{if(t)switch(e){case"src":u[i]?t.setAttr(e,u[i]):(u[i]=r.createAsyncTexture({attr:{src:i}}),u[i].then(a=>{u[i]=a.exportAsDataUrl(),t.setAttr(e,u[i])}));break;case"text":t.text(i);break;case"p-template":case"pTemplate":t instanceof m.canvasNodeExe&&t.addTemplate(s[i]);break;case"event":Object.entries(i).forEach(([a,l])=>{var b;return(b=t.on)==null?void 0:b.call(t,a,l)});break;case"block":t.block=!0;break;case"data":t.data(i);break;case"transform":t.setAttr(e,o(i));break;case"bbox":t.bbox=i;break;default:t.setAttr(e,i)}},k=(e,t)=>{Object.entries(t).forEach(([i,a])=>{let l=typeof a=="function"?a(e):a;if((i==="fillStyle"||i==="strokeStyle")&&typeof l=="string"&&l.startsWith("grad")){const b=l.match(/\(([^)]+)\)/)[1];l=g(b)}e.setStyle(i,l)})},f=e=>(e=S(e),(t,i)=>{if(/^on[A-Z]/.test(e)){const a=e.slice(2).toLowerCase();t.on&&t.on(a,i)}else typeof i=="function"&&(i=i(t));e!=="style"?C(e,t,i):k(t,i)});function h(e,t){return new m.canvasNodeExe(r.ctx,{el:e==="group"?"g":e,attr:{},style:{},bbox:t&&t.bbox!==void 0?t.bbox:!0},Math.round(Math.random()*1e7),0)}function o(e){if(typeof e=="object"&&!Array.isArray(e)&&e!==null)return e;const t={};for(const i in e=e.match(/(\w+\((\-?\d+\.?\d*e?\-?\d*,?)+\))+/g)){const a=e[i].match(/[\w\.\-]+/g);t[a.shift()]=a.map(l=>parseFloat(l))}return t}function g(e){return n[e]}function x(e){var t;return{nodeName:"animate",attr:{...(e==null?void 0:e.to)??{},style:null},style:((t=e==null?void 0:e.to)==null?void 0:t.style)??{},duration:e.duration||0,ease:e.ease||"default",loop:e.loop||0,end:e.end||null,delay:e.delay||0,direction:e.direction||"default",setAttr:function(i,a){},setStyle:function(i,a){},remove:function(){this.parent.interrupt()}}}function O(e){var t,i;return{nodeName:"animatePath",attr:{d:((t=e==null?void 0:e.to)==null?void 0:t.d)??"",style:null},style:((i=e==null?void 0:e.to)==null?void 0:i.style)??{},duration:e.duration||0,ease:e.ease||"default",loop:e.loop||0,end:e.end||null,delay:e.delay||0,direction:e.direction||"default",setAttr:function(a,l){},setStyle:function(a,l){},remove:function(){this.parent.interrupt()}}}return y}const G=c.defineComponent({props:{type:{type:String,required:!0,default:"pdf"},id:{type:String,required:!0,default:"pdf-frame-id"},height:{type:Number,required:!1,default:void 0},width:{type:Number,required:!1,default:void 0},layerSetting:{type:Object,required:!1,default:()=>{}},needOnAfterRender:{type:Boolean,required:!1,default:!1},setCtxClear:{type:Function,required:!1,default:null},config:{type:Object,required:!1,default:()=>{}},info:{type:Object,required:!1,default:()=>{}},encryption:{type:Object,required:!1,default:()=>{}},autoPagination:{type:Boolean,required:!1,default:!0}},emits:["on-resize","on-ready","on-after-render"],setup(r,u){let s,n=null;const y=c.getCurrentInstance();c.onMounted(()=>{c.nextTick().then(()=>{const f=u.slots.default;n||(r.type==="pdf"||r.type==="pdf-blob"?n=C(r):r.type==="canvas"?n=k(r):console.warn(`Unknown render context: ${r.type}`)),n!=null&&n.onResize&&n.onResize(()=>{u.emit("on-resize",{height:n.height,width:n.width})}),n!=null&&n.onChange&&n.onChange(g=>{var x;n instanceof m.PDFCreator&&((x=n==null?void 0:n.container)==null?void 0:x.tagName)==="IFRAME"&&n.container.setAttribute("src",g),r.needOnAfterRender&&u.emit("on-after-render",g)}),n!=null&&n.setClear&&typeof r.setCtxClear=="function"&&n.setClear(r.setCtxClear);const h=j(n),o=c.h(S,f);h(o,n),u.emit("on-ready",n)})}),c.onUnmounted(()=>{n&&(n.destroy(),n=null)}),c.watch([()=>r.height,()=>r.width],f=>{n.setSize&&n.setSize(r.width,r.height)},{deep:!0}),c.watch(()=>r.encryption,f=>{n.setConfig&&n.setConfig({encryption:f})},{deep:!0}),c.watch(()=>r.info,f=>{n.setConfig&&n.setConfig({info:f})},{deep:!0}),c.watch(()=>r.config,f=>{n.setConfig&&n.setConfig({...f})},{deep:!0});const S=c.defineComponent({setup(f,h){const o=c.getCurrentInstance();o.parent=y,o.appContext=y.appContext,o.root=y.root,o.provides=y.provides;const g=h.slots.default;return()=>c.h(c.Fragment,g())}});function C(f){let h=document.getElementById(s.props.id),o={...f.height!==void 0&&{height:f.height},...f.width!==void 0&&{width:f.width},...f.config||{},info:f.info||{},encryption:f.encryption||{}};return m.pdfLayer(h,o,{autoUpdate:!0,autoPagination:f.autoPagination})}function k(f){let h=document.getElementById(s.props.id);return m.canvasLayer(h,f.config,{...f.layerSetting})}switch(r.type){case"pdf":s=c.h("iframe",{id:r.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break;case"pdf-blob":s=c.h("div",{id:r.id,class:"renderOutput",style:{height:"100%",width:"100%"}});break;case"canvas":s=c.h("div",{id:r.id,class:"renderOutput",style:{height:r.height?r.height+"px":"100%",width:r.width?r.width+"px":"100%"}});break;case"default":s=c.h("iframe",{id:r.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break}return()=>s}});exports.default=G;
