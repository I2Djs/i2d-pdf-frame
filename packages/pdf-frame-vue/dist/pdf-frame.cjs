"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const h=require("i2djs"),f=require("vue"),O=["i-g","i-group","i-circle","i-line","i-path","i-ellipse","i-polygon","i-polyline","i-rect","i-text","i-image","i-page","i-linearGradient","i-radialGradient","i-page-template","i-animate","i-animatePath"];function U(i){const s={},m={},r={},{render:b}=f.createRenderer({patchProp(e,t,n,a,l,y,d,C,N){e&&c(t)(e,a)},insert:(e,t,n)=>{if(t=t||i,e&&t instanceof h.PDFCreator&&t.pages&&(["template","page"].includes(e.nodeName)||(t=t.pages.length?t.pages[0]:t.addPage())),!(!e||!(t!=null&&t.child))&&!(e instanceof h.canvasGradient))if(e.nodeName==="animate"||e.nodeName==="animatePath"){const a=e.nodeName==="animate"?"animateTo":"animatePathTo";e.parent=t,f.nextTick().then(()=>{t[a](e,e.from)})}else t.child([e])},remove:e=>{e!=null&&e.remove()},createElement:(e,t,n,a)=>{var N,A,T;const l=e.split("-").slice(1).join("-");let y=O.indexOf(e),d=null,C=i instanceof h.PDFCreator?"pdf":"canvas";if(y===-1&&console.warn(`Unknown PDF-Frame tag: ${e}`),(l==="animate"||l==="animatePath")&&C==="pdf")return null;switch(l){case"page-template":if(C!=="pdf")return console.warn("page-template element is invalid in canvas context"),null;d=i.createTemplate(),d.nodeName="template",m[a.id]=d;break;case"page":if(C!=="pdf")return console.warn("Page element is invalid in canvas context"),null;d=i.addPage(),d.nodeName="page";break;case"linearGradient":d=h.createLinearGradient(),r[a.id]=d,d.nodeName="linearGradient";break;case"radialGradient":d=h.createRadialGradient(),r[a.id]=d,d.nodeName="radialGradient";break;case"animate":d=x(a),a.from&&(d.from={attr:{...a.from,style:null},style:((N=a.from)==null?void 0:N.style)??{}});break;case"animatePath":d=q(a),a.from&&(d.from={attr:{d:((A=a==null?void 0:a.from)==null?void 0:A.d)??"",style:null},style:((T=a.from)==null?void 0:T.style)??{}});break;default:d=o(l,a);break}return d},createText:e=>{},createComment:e=>{},setText:(e,t)=>{},setElementText:(e,t)=>{},parentNode:e=>e&&e.dom.parent?e.dom.parent:null,nextSibling:e=>(t,n)=>{},querySelector:e=>i.fetchEl(e)||null}),S=e=>e.includes("-")?e.replace(/-([a-z])/g,(t,n)=>n.toUpperCase()):e,w=(e,t,n)=>{if(t)switch(e){case"src":s[n]?t.setAttr(e,s[n]):(s[n]=i.createAsyncTexture({attr:{src:n}}),s[n].then(a=>{s[n]=a.exportAsDataUrl(),t.setAttr(e,s[n])}));break;case"text":t.text(n);break;case"p-template":case"pTemplate":t instanceof h.canvasNodeExe&&t.addTemplate(m[n]);break;case"event":Object.entries(n).forEach(([a,l])=>{var y;return(y=t.on)==null?void 0:y.call(t,a,l)});break;case"block":t.block=!0;break;case"data":t.data(n);break;case"transform":t.setAttr(e,u(n));break;case"bbox":t.bbox=n;break;default:t.setAttr(e,n)}},k=(e,t)=>{Object.entries(t).forEach(([n,a])=>{let l=typeof a=="function"?a(e):a;if((n==="fillStyle"||n==="strokeStyle")&&typeof l=="string"&&l.startsWith("grad")){const y=l.match(/\(([^)]+)\)/)[1];l=g(y)}e.setStyle(n,l)})},c=e=>(e=S(e),(t,n)=>{if(/^on[A-Z]/.test(e)){const a=e.slice(2).toLowerCase();t.on&&t.on(a,n)}else typeof n=="function"&&(n=n(t));e!=="style"?w(e,t,n):k(t,n)});function o(e,t){return new h.canvasNodeExe(i.ctx,{el:e==="group"?"g":e,attr:{},style:{},bbox:t&&t.bbox!==void 0?t.bbox:!0},Math.round(Math.random()*1e7),0)}function u(e){if(typeof e=="object"&&!Array.isArray(e)&&e!==null)return e;const t={};for(const n in e=e.match(/(\w+\((\-?\d+\.?\d*e?\-?\d*,?)+\))+/g)){const a=e[n].match(/[\w\.\-]+/g);t[a.shift()]=a.map(l=>parseFloat(l))}return t}function g(e){return r[e]}function x(e){var t;return{nodeName:"animate",attr:{...(e==null?void 0:e.to)??{},style:null},style:((t=e==null?void 0:e.to)==null?void 0:t.style)??{},duration:e.duration||0,ease:e.ease||"default",loop:e.loop||0,end:e.end||null,delay:e.delay||0,direction:e.direction||"default",setAttr:function(n,a){},setStyle:function(n,a){},remove:function(){this.parent.interrupt()}}}function q(e){var t,n;return{nodeName:"animatePath",attr:{d:((t=e==null?void 0:e.to)==null?void 0:t.d)??"",style:null},style:((n=e==null?void 0:e.to)==null?void 0:n.style)??{},duration:e.duration||0,ease:e.ease||"default",loop:e.loop||0,end:e.end||null,delay:e.delay||0,direction:e.direction||"default",setAttr:function(a,l){},setStyle:function(a,l){},remove:function(){this.parent.interrupt()}}}return b}const j=f.defineComponent({props:{type:{type:String,required:!0,default:"pdf"},id:{type:String,required:!0,default:"pdf-frame-id"},height:{type:Number,required:!1,default:void 0},width:{type:Number,required:!1,default:void 0},layerSetting:{type:Object,required:!1,default:()=>{}},onUpdate:{type:Function,required:!1,default:null},onClear:{type:Function,required:!1,default:null},config:{type:Object,required:!1,default:()=>{}},info:{type:Object,required:!1,default:()=>{}},encryption:{type:Object,required:!1,default:()=>{}},autoPagination:{type:Boolean,required:!1,default:!0}},emits:["on-resize","on-ready"],setup(i,s){let m,r=null;const b=f.getCurrentInstance();f.onMounted(()=>{f.nextTick().then(()=>{const c=s.slots.default;r||(i.type==="pdf"||i.type==="pdf-blob"?r=w(i):i.type==="canvas"?r=k(i):console.warn(`Unknown render context: ${i.type}`)),r&&r.onResize&&r.onResize(()=>{s.emit("on-resize",{height:r.height,width:r.width})}),r&&r.onChange&&r.onChange(g=>{r&&r.container&&r.container.tagName==="IFRAME"&&r.container.setAttribute("src",g),i.onUpdate&&typeof i.onUpdate=="function"&&i.onUpdate(g)});const o=U(r),u=f.h(S,c);o(u,r),s.emit("on-ready",r)})}),f.onUnmounted(()=>{r&&(r.destroy(),r=null)}),f.watch([()=>i.height,()=>i.width],c=>{r.setSize&&r.setSize(i.width,i.height)},{deep:!0}),f.watch(()=>i.encryption,c=>{r.setConfig&&r.setConfig({encryption:c})},{deep:!0}),f.watch(()=>i.info,c=>{r.setConfig&&r.setConfig({info:c})},{deep:!0}),f.watch(()=>i.config,c=>{r.setConfig&&r.setConfig({...c})},{deep:!0});const S=f.defineComponent({setup(c,o){const u=f.getCurrentInstance();u.parent=b,u.appContext=b.appContext,u.root=b.root,u.provides=b.provides;const g=o.slots.default;return()=>f.h(f.Fragment,g())}});function w(c){let o=document.getElementById(m.props.id),u={...c.height!==void 0&&{height:c.height},...c.width!==void 0&&{width:c.width},...c.config||{},info:c.info||{},encryption:c.encryption||{}};return h.pdfLayer(o,u,{autoUpdate:!0,autoPagination:c.autoPagination,onUpdate:x=>{o.tagName==="IFRAME"&&o.setAttribute("src",x),c.onUpdate&&typeof c.onUpdate=="function"&&c.onUpdate(x)}})}function k(c){let o=document.getElementById(m.props.id);const u=h.canvasLayer(o,c.config,{...c.layerSetting});return c.onClear&&typeof c.onClear=="function"&&u.setClear(c.onClear),u}switch(i.type){case"pdf":m=f.h("iframe",{id:i.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break;case"pdf-blob":m=f.h("div",{id:i.id,class:"renderOutput",style:{height:"100%",width:"100%"}});break;case"canvas":m=f.h("div",{id:i.id,class:"renderOutput",style:{height:i.height?i.height+"px":"100%",width:i.width?i.width+"px":"100%"}});break;case"default":m=f.h("iframe",{id:i.id,class:"pdfIframe renderOutput",type:"application/pdf",src:null,style:{height:"100%",width:"100%"}});break}return()=>m}});exports.default=j;
